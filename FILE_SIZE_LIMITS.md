# 文件大小和文本长度限制说明

## 限制参数

### 前端限制（RequestInput.jsx）
- **单个文件大小限制**：500 KB
- **总文本长度限制**：120,000 字符（约 120K）
- **警告阈值**：100,000 字符（约 100K）

### 后端限制（analyzer.js）
- **Token 限制**：128,000 tokens
- **估算公式**：`text.length * 0.5` tokens

## 功能说明

### 1. 文件上传检查
- 上传文件时自动检查每个文件的大小
- 超过 500KB 的文件会被拒绝，并显示友好的错误提示
- 只有符合大小要求的文件会被添加到上传列表

### 2. 实时文本长度监控
- 输入文本时实时显示字符数统计
- **100K-120K 字符**：显示黄色警告，提示已使用百分比
- **超过 120K 字符**：显示红色错误，禁止提交

### 3. 提交前验证
- 提交前检查总文本长度（问询 + 文件内容）
- 超过限制时显示详细的错误信息和建议

### 4. 后端二次验证
- 后端使用 token 估算进行二次验证
- 提供更准确的 token 使用情况统计

## 用户体验优化

### 视觉反馈
- 警告状态：黄色背景，橙色文字
- 错误状态：红色背景，红色文字，脉冲动画
- 实时显示：字符数、百分比、超出量

### 错误提示
所有错误提示都包含：
- 当前状态（文件大小/字符数）
- 系统限制
- 超出量和百分比
- 具体的解决建议

## 建议的文件大小

### 保守建议（推荐）
- 纯文本：100-120 KB
- Word 文档：200-300 KB
- PDF：50-100 页

### 激进建议（接近上限）
- 纯文本：200-240 KB
- Word 文档：500-800 KB
- PDF：100-200 页

## 修改限制

如需调整限制，修改以下常量：

### 前端（src/components/RequestInput.jsx）
```javascript
const MAX_FILE_SIZE = 500 * 1024 // 单个文件大小（字节）
const MAX_TOTAL_TEXT_LENGTH = 120000 // 总文本长度（字符）
const WARNING_TEXT_LENGTH = 100000 // 警告阈值（字符）
```

### 后端（server/analyzer.js）
```javascript
const maxTokens = 128000 // Token 限制
```

## 注意事项

1. 前端限制是第一道防线，提供即时反馈
2. 后端限制是最终保障，防止 API 调用失败
3. 建议保持前端限制略低于后端限制，留出安全余量
4. Token 估算是近似值，实际 token 数可能有偏差
